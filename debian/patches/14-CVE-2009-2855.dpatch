#! /bin/sh /usr/share/dpatch/dpatch-run

@DPATCH@
--- ../old/squid3-3.0.PRE5/src/HttpHeaderTools.cc	2006-09-03 05:30:40.000000000 +0000
+++ squid3-3.0.PRE5/src/HttpHeaderTools.cc	2010-02-03 13:47:03.000000000 +0000
@@ -292,19 +292,17 @@
     do {
         *pos += strcspn(*pos, delim[quoted]);
 
-        if (**pos == del)
-            break;
-
         if (**pos == '"') {
             quoted = !quoted;
             *pos += 1;
-        }
 
-        if (quoted && **pos == '\\') {
+	} else if (quoted && **pos == '\\') {
             *pos += 1;
 
             if (**pos)
                 *pos += 1;
+            } else {
+     	      break;
         }
     } while (**pos);
 
