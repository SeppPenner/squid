Description: Ignore Range headers with unidentifiable byte-range values
 If squid is unable to determine the byte value for ranges, treat the
 header as invalid.
Origin: upstream, http://www.squid-cache.org/Versions/v3/3.3/changesets/squid-3.3-12680.patch
Bug-Debian: https://bugs.debian.org/759509
Author: Amos Jeffries <squid3@treenet.co.nz>
Last-Update: 2014-08-28
Applied-Upstream: 3.3.13, 3.4.7

=== modified file 'src/HttpHdrRange.cc'
--- a/src/HttpHdrRange.cc
+++ b/src/HttpHdrRange.cc
@@ -92,7 +92,7 @@ HttpHdrRangeSpec::parseInit(const char *
 
     /* is it a suffix-byte-range-spec ? */
     if (*field == '-') {
-        if (!httpHeaderParseOffset(field + 1, &length))
+        if (!httpHeaderParseOffset(field + 1, &length) || !known_spec(length))
             return false;
     } else
         /* must have a '-' somewhere in _this_ field */
@@ -100,7 +100,7 @@ HttpHdrRangeSpec::parseInit(const char *
             debugs(64, 2, "invalid (missing '-') range-spec near: '" << field << "'");
             return false;
         } else {
-            if (!httpHeaderParseOffset(field, &offset))
+            if (!httpHeaderParseOffset(field, &offset) || !known_spec(offset))
                 return false;
 
             ++p;
@@ -109,7 +109,7 @@ HttpHdrRangeSpec::parseInit(const char *
             if (p - field < flen) {
                 int64_t last_pos;
 
-                if (!httpHeaderParseOffset(p, &last_pos))
+                if (!httpHeaderParseOffset(p, &last_pos) || !known_spec(last_pos))
                     return false;
 
                 // RFC 2616 s14.35.1 MUST: last-byte-pos >= first-byte-pos
